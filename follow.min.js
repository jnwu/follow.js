var url="http://localhost:3000";(function(e){e.fn.broker=function(t){function r(t){e.ajax({type:"GET",crossDomain:true,url:url+"/thing/"+t.name+"/events?limit=1",dataType:"JSON",success:function(e){i(e,t)}})}function i(e,t){if(t.callback){var n=t.callback;n(e)}setTimeout(function(){r(t)},250)}function s(t,n){e.ajax({type:"POST",crossDomain:true,url:t,data:n,contentType:"application/json",dataType:"JSON",error:function(e){o(e)}})}function o(e){console.log(e)}var n=(new Date).getTime();t=e.extend({name:this.attr("id"),listen:false,callback:null,timestamp:(new Date).getTime()},t);this.each(function(){if(t.follow){}else if(t.listen){s(url+"/thing",'{ "thing": { "name": "'+t.name+'", "following": [] } }');if(t.parent){s(url+"/thing/"+t.name,'{ "thing": { "name": "'+t.name+'", "following": ["'+t.parent+'"] } }')}r(t)}else create(t)})}})(jQuery)